{%- liquid
  assign page_handle = page.handle
  assign enable_breadcrumb = settings.enable_breadcrumb
  assign listObject = settings.page_breadcrumb | split: ','
  
  if listObject contains page_handle
    assign showBreadcrumb = false
  else
    assign showBreadcrumb = true
  endif

  # Check if breadcrumb should show on this template
  assign show_breadcrumb = true
  if template == 'index' or template == 'cart'
    assign show_breadcrumb = false
  endif
  
  if template contains 'blog' and settings.enable_post == false
    assign show_breadcrumb = false
  endif
  if template contains 'article' and settings.enable_article == false
    assign show_breadcrumb = false
  endif
  if template contains 'product' and settings.enable_product == false
    assign show_breadcrumb = false
  endif
  if template contains 'customers' and settings.enable_customer == false
    assign show_breadcrumb = false
  endif
-%}

{%- if enable_breadcrumb and showBreadcrumb and show_breadcrumb -%}
<style>
  .g-breadcrumb{
    border-radius: 0;
    flex-direction: column;
    color: {{ settings.color_breadcrumbs }};
    padding: 16px 0;
    margin: 0;
    background: {{ settings.bg_breadcrumb }};
    border-top: 1px solid {{ settings.border_breadcrumb }};
  }
  .g-breadcrumb a, .g-breadcrumb span { 
    padding: 0 3px; 
    font-size: 14px; 
    line-height: 20px; 
    display: inline-block; 
  }
  .g-breadcrumb a {
    color: {{ settings.color_breadcrumbs_active }};
  }
  .g-breadcrumb .container, .g-breadcrumb .container-fluid { 
    z-index: 2; 
    position: relative; 
  }
  .br-title {
    color: {{ settings.color_breadcrumbs }};
  }
  .br-title svg {
    width: 23px;
    height: 23px;
  }
</style>

<nav class="breadcrumb g-breadcrumb text-{{ settings.align_bread }}" role="navigation" aria-label="breadcrumbs">
  <div class="{{ settings.layout_bread }}">
    <a href="/" title="{{ 'general.breadcrumb.home' | t }}">{{ 'general.breadcrumb.home' | t }}</a>
    
    {% comment %} Product pages {% endcomment %}
    {% if template contains 'product' %}
      {% comment %} Show Collections link if product is in a collection {% endcomment %}
      {% if collections.size > 0 %}
        <span aria-hidden="true"> / </span>
        <a href="/collections">{{ 'general.breadcrumb.collections' | t | default: 'Collections' }}</a>
      {% endif %}
      
      {% comment %} Show specific collection if available {% endcomment %}
      {% if collection and collection.url %}
        <span aria-hidden="true"> / </span>
        <a href="{{ collection.url }}">{{ collection.title }}</a>
      {% elsif product.collections.size > 0 %}
        {% assign first_collection = product.collections.first %}
        <span aria-hidden="true"> / </span>
        <a href="{{ first_collection.url }}">{{ first_collection.title }}</a>
      {% endif %}
      
      <span aria-hidden="true"> / </span>
      <span>{{ product.title }}</span>
      
    {% comment %} Collection pages {% endcomment %}
    {% elsif template contains 'collection' and collection.handle %}
      <span aria-hidden="true"> / </span>
      <a href="/collections">{{ 'general.breadcrumb.collections' | t | default: 'Collections' }}</a>
      <span aria-hidden="true"> / </span>
      
      {% if current_tags %}
        <a href="{{ collection.url }}">{{ collection.title }}</a>
        <span aria-hidden="true"> / </span>
        <span>{{ current_tags | join: " + " }}</span>
      {% else %}
        <span>{{ collection.title }}</span>
      {% endif %}
      
    {% comment %} Blog pages {% endcomment %}
    {% elsif template == 'blog' %}
      <span aria-hidden="true"> / </span>
      <a href="/blogs">{{ 'general.breadcrumb.blogs' | t | default: 'Blogs' }}</a>
      <span aria-hidden="true"> / </span>
      
      {% if current_tags %}
        <a href="{{ blog.url }}">{{ blog.title }}</a>
        <span aria-hidden="true"> / </span>
        <span>{{ current_tags | join: " + " }}</span>
      {% else %}
        <span>{{ blog.title }}</span>
      {% endif %}
      
    {% comment %} Article pages {% endcomment %}
    {% elsif template == 'article' %}
      <span aria-hidden="true"> / </span>
      <a href="/blogs">{{ 'general.breadcrumb.blogs' | t | default: 'Blogs' }}</a>
      <span aria-hidden="true"> / </span>
      <a href="{{ blog.url }}">{{ blog.title }}</a>
      <span aria-hidden="true"> / </span>
      <span>{{ article.title }}</span>
      
    {% comment %} Regular pages {% endcomment %}
    {% elsif template contains 'page' %}
      <span aria-hidden="true"> / </span>
      <span>{{ page.title }}</span>
      
    {% comment %} Search pages {% endcomment %}
    {% elsif template == 'search' %}
      <span aria-hidden="true"> / </span>
      <span>{{ 'general.search.title' | t | default: 'Search' }}</span>
      {% if search.terms %}
        <span aria-hidden="true"> / </span>
        <span>"{{ search.terms }}"</span>
      {% endif %}
      
    {% comment %} Customer pages {% endcomment %}
    {% elsif template contains 'customers' %}
      <span aria-hidden="true"> / </span>
      <span>{{ 'customer.account.title' | t | default: 'Account' }}</span>
      
    {% comment %} Default fallback {% endcomment %}
    {% else %}
      <span aria-hidden="true"> / </span>
      <span>{{ page_title }}</span>
    {% endif %}
  </div>
</nav>
{%- endif -%}
